<ion-header>
  <ion-toolbar>
<!--    <ion-buttons slot="start">-->
<!--      <ion-back-button mode="md" [defaultHref]="'/'"></ion-back-button>-->
<!--    </ion-buttons>-->


    <!--    <ion-title style="display: flex; align-items: center">-->
<!--    <div style="display: grid; grid-gap: 5px; grid-template-columns: auto fit-content() auto auto ">-->
    <div class="toolbar">
      <app-app-logo></app-app-logo>
<!--      <ion-title style="font-size: 85%">Life<br>Suite</ion-title> &lt;!&ndash; this could be part of the svg logo - more compact and fancy &ndash;&gt;-->
<!--      <svg height="50" viewBox="0 0 104 104" fill="none" xmlns="http://www.w3.org/2000/svg">-->
<!--        <path d="M12.4682 45.4647V25.0821H14.9364V43.2751H24.4111V45.4647H12.4682ZM30.701 25.0821V45.4647H28.2328V25.0821H30.701ZM35.6498 45.4647V25.0821H47.8714V27.2717H38.118V34.1587H46.9558V36.3483H38.118V45.4647H35.6498ZM52.0987 45.4647V25.0821H64.3998V27.2717H54.5669V34.1587H63.7629V36.3483H54.5669V43.2751H64.5591V45.4647H52.0987ZM22.8287 64.9441C22.749 64.1413 22.4073 63.5176 21.8036 63.073C21.1998 62.6285 20.3804 62.4062 19.3453 62.4062C18.642 62.4062 18.0482 62.5058 17.5638 62.7048C17.0795 62.8972 16.7079 63.1659 16.4492 63.511C16.197 63.856 16.071 64.2474 16.071 64.6853C16.0577 65.0503 16.134 65.3687 16.2999 65.6408C16.4724 65.9128 16.7079 66.1483 17.0065 66.3474C17.3051 66.5398 17.6501 66.709 18.0415 66.855C18.433 66.9943 18.851 67.1137 19.2955 67.2132L21.1268 67.6512C22.0159 67.8502 22.832 68.1156 23.5751 68.4473C24.3182 68.7791 24.9618 69.1871 25.5058 69.6715C26.0499 70.1558 26.4712 70.7264 26.7698 71.3833C27.075 72.0402 27.2309 72.7932 27.2376 73.6425C27.2309 74.8899 26.9125 75.9714 26.2821 76.887C25.6585 77.796 24.7561 78.5026 23.5751 79.0068C22.4007 79.5045 20.9841 79.7533 19.3254 79.7533C17.6799 79.7533 16.2468 79.5012 15.026 78.9969C13.8118 78.4926 12.863 77.7462 12.1796 76.7576C11.5028 75.7624 11.1478 74.5316 11.1147 73.0653H15.2847C15.3312 73.7487 15.5269 74.3193 15.8719 74.7771C16.2236 75.2283 16.6913 75.57 17.2752 75.8022C17.8657 76.0278 18.5325 76.1406 19.2756 76.1406C20.0055 76.1406 20.6391 76.0344 21.1766 75.8221C21.7206 75.6098 22.1419 75.3145 22.4405 74.9363C22.7391 74.5581 22.8884 74.1235 22.8884 73.6326C22.8884 73.1747 22.7523 72.7899 22.4803 72.4781C22.2149 72.1662 21.8235 71.9008 21.3059 71.6819C20.795 71.4629 20.168 71.2639 19.4249 71.0847L17.2055 70.5274C15.4871 70.1094 14.1302 69.4559 13.135 68.5668C12.1398 67.6777 11.6455 66.4801 11.6521 64.974C11.6455 63.7399 11.9739 62.6617 12.6374 61.7394C13.3075 60.8172 14.2265 60.0973 15.3942 59.5798C16.562 59.0622 17.8889 58.8035 19.3752 58.8035C20.8879 58.8035 22.2083 59.0622 23.3362 59.5798C24.4708 60.0973 25.3532 60.8172 25.9836 61.7394C26.6139 62.6617 26.939 63.7299 26.9589 64.9441H22.8287ZM42.726 59.0821H47.0354V72.3188C47.0354 73.8051 46.6804 75.1055 45.9705 76.2202C45.2672 77.3348 44.2819 78.204 43.0146 78.8277C41.7473 79.4448 40.2711 79.7533 38.5858 79.7533C36.8939 79.7533 35.4143 79.4448 34.147 78.8277C32.8798 78.204 31.8945 77.3348 31.1912 76.2202C30.4879 75.1055 30.1362 73.8051 30.1362 72.3188V59.0821H34.4456V71.9506C34.4456 72.7269 34.6148 73.4169 34.9532 74.0207C35.2982 74.6245 35.7825 75.0989 36.4062 75.4439C37.0299 75.7889 37.7564 75.9614 38.5858 75.9614C39.4218 75.9614 40.1483 75.7889 40.7654 75.4439C41.3891 75.0989 41.8701 74.6245 42.2085 74.0207C42.5535 73.4169 42.726 72.7269 42.726 71.9506V59.0821ZM54.8903 59.0821V79.4647H50.5809V59.0821H54.8903ZM57.6596 62.6351V59.0821H74.3995V62.6351H68.1594V79.4647H63.8997V62.6351H57.6596ZM77.1563 79.4647V59.0821H90.8907V62.6351H81.4657V67.4919H90.184V71.0449H81.4657V75.9117H90.9305V79.4647H77.1563Z"-->
<!--              fill="var(&#45;&#45;ion-color-primary)"/>-->
<!--      </svg>-->
<!--      <svg height="40" viewBox="0 0 104 104" fill="none" xmlns="http://www.w3.org/2000/svg">-->
<!--        <path d="M11.1943 45L14.5781 24.6175H17.0463L14.0208 42.8105H23.4955L23.1372 45H11.1943ZM32.8109 24.6175L29.4271 45H26.9589L30.3427 24.6175H32.8109ZM34.3759 45L37.7597 24.6175H49.9813L49.623 26.807H39.8697L38.7152 33.6941H47.5529L47.1946 35.8836H38.3569L36.8441 45H34.3759ZM50.8248 45L54.2086 24.6175H66.5098L66.1515 26.807H56.3185L55.164 33.6941H64.36L64.0018 35.8836H54.8057L53.6512 42.8105H63.6435L63.2852 45H50.8248Z"-->
<!--              fill="var(&#45;&#45;ion-color-primary)"/>-->
<!--        <path d="M22.8287 64.4794C22.749 63.6766 22.4073 63.0529 21.8036 62.6084C21.1998 62.1638 20.3804 61.9416 19.3453 61.9416C18.642 61.9416 18.0482 62.0411 17.5638 62.2401C17.0795 62.4326 16.7079 62.7013 16.4492 63.0463C16.197 63.3913 16.071 63.7828 16.071 64.2207C16.0577 64.5856 16.134 64.9041 16.2999 65.1761C16.4724 65.4481 16.7079 65.6837 17.0065 65.8827C17.3051 66.0751 17.6501 66.2443 18.0415 66.3903C18.433 66.5296 18.851 66.6491 19.2955 66.7486L21.1268 67.1865C22.0159 67.3855 22.832 67.6509 23.5751 67.9827C24.3182 68.3144 24.9618 68.7225 25.5058 69.2068C26.0499 69.6912 26.4712 70.2618 26.7698 70.9186C27.075 71.5755 27.2309 72.3286 27.2376 73.1778C27.2309 74.4252 26.9125 75.5067 26.2821 76.4223C25.6585 77.3313 24.7561 78.0379 23.5751 78.5422C22.4007 79.0398 20.9841 79.2886 19.3254 79.2886C17.6799 79.2886 16.2468 79.0365 15.026 78.5322C13.8118 78.028 12.863 77.2816 12.1796 76.2929C11.5028 75.2977 11.1478 74.0669 11.1147 72.6006H15.2847C15.3312 73.284 15.5269 73.8546 15.8719 74.3124C16.2236 74.7636 16.6913 75.1053 17.2752 75.3375C17.8657 75.5631 18.5325 75.6759 19.2756 75.6759C20.0055 75.6759 20.6391 75.5697 21.1766 75.3574C21.7206 75.1451 22.1419 74.8498 22.4405 74.4717C22.7391 74.0935 22.8884 73.6589 22.8884 73.1679C22.8884 72.7101 22.7523 72.3253 22.4803 72.0134C22.2149 71.7016 21.8235 71.4362 21.3059 71.2172C20.795 70.9983 20.168 70.7992 19.4249 70.6201L17.2055 70.0627C15.4871 69.6447 14.1302 68.9912 13.135 68.1021C12.1398 67.213 11.6455 66.0154 11.6521 64.5093C11.6455 63.2752 11.9739 62.197 12.6374 61.2748C13.3075 60.3525 14.2265 59.6326 15.3942 59.1151C16.562 58.5976 17.8889 58.3388 19.3752 58.3388C20.8879 58.3388 22.2083 58.5976 23.3362 59.1151C24.4708 59.6326 25.3532 60.3525 25.9836 61.2748C26.6139 62.197 26.939 63.2652 26.9589 64.4794H22.8287ZM42.726 58.6175H47.0354V71.8542C47.0354 73.3404 46.6804 74.6408 45.9705 75.7555C45.2672 76.8702 44.2819 77.7394 43.0146 78.363C41.7473 78.9801 40.2711 79.2886 38.5858 79.2886C36.8939 79.2886 35.4143 78.9801 34.147 78.363C32.8798 77.7394 31.8945 76.8702 31.1912 75.7555C30.4879 74.6408 30.1362 73.3404 30.1362 71.8542V58.6175H34.4456V71.4859C34.4456 72.2622 34.6148 72.9523 34.9532 73.556C35.2982 74.1598 35.7825 74.6342 36.4062 74.9792C37.0299 75.3242 37.7564 75.4968 38.5858 75.4968C39.4218 75.4968 40.1483 75.3242 40.7654 74.9792C41.3891 74.6342 41.8701 74.1598 42.2085 73.556C42.5535 72.9523 42.726 72.2622 42.726 71.4859V58.6175ZM54.8903 58.6175V79H50.5809V58.6175H54.8903ZM57.6596 62.1705V58.6175H74.3995V62.1705H68.1594V79H63.8997V62.1705H57.6596ZM77.1563 79V58.6175H90.8907V62.1705H81.4657V67.0273H90.184V70.5803H81.4657V75.447H90.9305V79H77.1563Z"-->
<!--              fill="var(&#45;&#45;ion-color-secondary)"/>-->
<!--        <rect x="0.5" y="0.5" width="103" height="103" stroke="black" stroke-opacity="0.13"/>-->
<!--      </svg>-->



      <!--      <ion-button color="primary" routerLink="/" > < </ion-button>-->
      <span style="flex-grow: 1"><!--Search or add--></span>

      <ion-button
        [routerLink]="'/tree'"
        size="small"
      >
        Plan
      </ion-button>

      <app-what-next-button></app-what-next-button>

      <ion-buttons slot="end">
        <ion-button
          *ngIf="feat.journal"
          [routerLink]="['/journal/write/new']"
        >
          <ion-icon
            class="action-icon" name="pencil" slot="icon-only"
          ></ion-icon>
          <!-- FIXME ion-button prolly better in ion-buttons -->
        </ion-button>
        <odm-sync-status-icon></odm-sync-status-icon>
      </ion-buttons>

    </div>

  </ion-toolbar>

  <div
    style="display: flex; align-items: stretch"
  >
    <div style="flex-grow: 1; color: white">
      <div
        (keyup.enter)="addTask(); $event.stopPropagation()"
        (keyup.meta.enter)="addToLearn(); $event.stopPropagation()"
        (keyup.alt.enter)="addToLearn(); $event.stopPropagation()"
        (keyup.control.enter)="addToLearn(); $event.stopPropagation()"
      >
        <app-search-or-add-text-editor
          [formControl1]="searchFormControl"
        ></app-search-or-add-text-editor>

        <ion-button
          [hidden]="! hasSearchText()"
          (click)="clearInput()"
        ><ion-icon name="close-outline"></ion-icon></ion-button>
      </div>

      <!--
        https://medium.com/madewithply/ionic-4-long-press-gestures-96cf1e44098b
        https://forum.ionicframework.com/t/ionic-5-long-press-gesture-example/188746/2
        https://ionicframework.com/docs/utilities/gestures
      -->
      <app-selection-info
        [selection]="listModel.selection"
      ></app-selection-info>

      <ion-button
        (press)="addTask(true)"
        (click)="addTask()"
      ><ion-icon name="add-circle-outline"></ion-icon>&nbsp;TASK</ion-button>

      <ion-button
        (press)="addToLearn(true)"
        (click)="addToLearn()"
      ><ion-icon name="add-circle-outline"></ion-icon>&nbsp;LEARN</ion-button>

      <ion-button
        *ngIf="feat.showExperimental"
        [routerLink]="['/journal/write/new']"
        (click)="addToJournal()"
      ><ion-icon name="add-circle-outline"></ion-icon>&nbsp;JOURNAL</ion-button>

      <ion-buttons style="display: inline-block">
        <ion-button
          (click)="onClickListOptions($event)"
        >
          <ion-icon
            slot="icon-only"
            style="color: var(--ion-color-primary);"
            name="filter"
          ></ion-icon>
        </ion-button>
      </ion-buttons>


      <ion-text style="color: gray">
        <span *ngIf="filteredItem$s.length !== item$s.length">{{filteredItem$s.length}} /</span>
        {{ item$s.length }}
        <app-learn-stats *ngIf="feat.stats"><!-- FIXME ugly --></app-learn-stats>
      </ion-text>
    </div>
    <app-mic *ngIf="feat.buggy"
      style="display: flex; align-items: stretch; padding-bottom: 8px;"></app-mic>

  </div>
</ion-header>

<ion-content
  (window:keyup.meta.enter)="addToLearn()"
>
<!--  <app-toggle option="listFilterItemNeedProcessing"-->
<!--  >Need Processing</app-toggle>-->


<!--  <ng-container *ngFor="let item of items; trackBy: trackByFn">-->
<!--    <app-actionable-item-->
<!--      [hidden]="! matchesSearch(item)"-->
<!--      [item]="item"-->
<!--    ></app-actionable-item>-->

<!--  </ng-container>-->
  <ng-container *ngIf="(! (authService.authUser$ | async)) else loggedIn">

    <div style="display: flex; flex-direction: row; align-items: center; margin: 10px">
      Please &nbsp;
      <ion-button (click)="authService.logInViaGoogle()">LOG IN</ion-button>

    </div>

  </ng-container>

  <ng-template #loggedIn>
    <app-item-list
      [listModel]="listModel"
    ></app-item-list>
  </ng-template>

</ion-content>
